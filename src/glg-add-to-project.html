<link rel="import" href="../node_modules/glg-current-user/src/glg-current-user.html">
<link rel="import" href="../node_modules/glg-nectar/src/glg-nectar.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/core-selector/core-selector.html">
<polymer-element name="glg-add-to-project" attributes="cmids appName rmPersonId"
  on-core-select="{{filtersChanged}}"
  on-inputchange="{{queryChanged}}"
  on-user="{{getMyProjects}}"
  on-results="{{displayNectarResults}}"
  >
  <template>
    <link rel="stylesheet" type="text/css" href="./glg-add-to-project.less">
    <glg-current-user id="atpuser" username="{{username}}"></glg-current-user>
    <core-ajax
      auto=true
      id="myprojects"
      method="GET"
      url=""
      handleAs="json"
      withCredentials=true
      on-core-response="{{buildHummingbirdIndex}}">
    </core-ajax>
    <glg-nectar
      id="nectar"
      urls="wss://nectar.glgroup.com/ws"
      entities='["consults"]'
      options='{"interleave":true,
          "scoreThreshold": 0.5,
          "howMany": 5,
          "secondarySortField": "createDate",
          "secondarySortOrder": "desc"}'
      >
    </glg-nectar>
    <h1>Add to Project</h1>
    <div id="spinner" class="progress"><div>Loadingâ€¦</div></div>
    <div id="inputwrapper" class="glg-hidden">
      <div id="projowner">
        <span class="selectHead">owner:</span>
        <core-selector id="selectProjOwner" class="options" selected="0">
          <span>mine</span>
          <span>anyone</span>
        <core-selector>
      </div>
      <div id="projtype">
        <span class="selectHead">type:</span>
        <core-selector id="selectProjType" class="options" selected="0">
          <span>consults</span>
          <span>surveys</span>
          <span>meetings</span>
        <core-selector>
      </div>
      <ui-typeahead
          id="projects"
          placeholder="Find a project by name..."
          debounce="50">
        <icon search></icon>
        <template id="projectMatches" repeat="{{matches}}">
          <ui-typeahead-item>
            <div>{{name}}<div>
            <div style="margin-left: 1rem; font-size: 0.75rem!important;">
              <span>{{createDate | date}} - </span>
              <span style="font-weight:bold;">{{firm}}</span>
            </div>
          </ui-typeahead-item>
        </template>
      </ui-typeahead>
    </div>
  </template>
  <script src="../bower_components/polymer-filters/filter-date.js"></script>
  <script src="./glg-add-to-project.litcoffee"></script>
</polymer-element>
