<link rel="import" href="https://services.glgresearch.com/ui-toolkit/node_modules/glg-nectar/src/glg-nectar.html">
<link rel="import" href="https://services.glgresearch.com/ui-toolkit/node_modules/ui-typeahead/src/ui-typeahead.html">
<link rel="import" href="https://services.glgresearch.com/ui-toolkit/node_modules/glg-current-user/src/glg-current-user.html">
<link rel="import" href="../bower_components/core-selector/core-selector.html">
<polymer-element name="glg-add-to-project" attributes="cmIds appName hideUI hideOwnerFilter hideProjType hideExperts rmPersonId projType projOwner"
  on-core-select="{{filtersUpdated}}"
  on-inputchange="{{queryUpdated}}"
  on-user="{{getMyProjects}}"
  on-results="{{displayNectarResults}}"
  on-itemselected="{{selectProject}}"
  >
  <template>
    <link rel="stylesheet" type="text/css" href="./glg-add-to-project.less" shim-shadowdom>
    <glg-current-user id="atpuser" username="{{username}}"></glg-current-user>
    <glg-nectar
      id="nectar"
      urls="wss://nectar.glgroup.com/ws"
      entities="consults"
      appName={{appName}}
      interleave="true"
      scoreThreshold="0.5"
      howMany="10"
      secondarySortField="createDate"
      secondarySortOrder="desc"
      >
    </glg-nectar>
    <div id="experts" class="to-be-added">
      <span style="font-weight:bold;padding-right:1rem;">Attaching:</span>
      <span id="toBeAdded">{{councilMembersStr}}</span>
    </div>
    <icon spinner id="hbfetching" class="progress"></icon>
    <div id="inputwrapper" hidden=true>
      <div id="projowner">
        <span>
          <core-selector id="selectProjOwner" multi="false" class="options" selected="0">
            <span id="mine">my</span>
            <span id="any">all</span>
          <core-selector>
        </span>
        <span id="filterPipe" style="font-size: 1rem; font-weight:bold; color:lightgrey;">|</span>
        <span>
          <core-selector id="selectProjType" multi="false" class="options" selected="0">
            <span>consults</span>
            <span>surveys</span>
            <span>meetings</span>
          <core-selector>
        </span>
      </div>
      <ui-typeahead
          id="projects"
          sticky
          placeholder="Search {{projOwner}} {{projType}}..."
          debounce="50">
        <template id="projectMatches" repeat="{{matches}}">
          <ui-typeahead-item>
            <div class="proj-name">
              <span class="ico-add"><icon plus></icon></span>
              <span>{{name}}</span>
              <div class="proj-meta">
                <span>{{createDate | date}} </span>
                <span class="proj-meta-important"> {{firm || client || type}}</span>
              </div>
            </div>
          </ui-typeahead-item>
        </template>
      </ui-typeahead>
      <icon search></icon>
    </div>
  </template>
  <script src="../bower_components/polymer-filters/filter-date.js"></script>
  <script src="./glg-add-to-project.litcoffee"></script>
</polymer-element>
