<link rel="import" href="../node_modules/glg-current-user/src/glg-current-user.html">
<link rel="import" href="../node_modules/glg-nectar/src/glg-nectar.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/core-selector/core-selector.html">
<link rel="import" href="../node_modules/ui-typeahead/src/ui-typeahead.html">
<polymer-element name="glg-add-to-project" attributes="cmids appName rmPersonId projectId"
  on-core-select="{{filtersChanged}}"
  on-inputchange="{{queryUpdated}}"
  on-user="{{getMyProjects}}"
  on-results="{{displayNectarResults}}"
  on-itemselected="{{selectProject}}"
  >
  <template>
    <link rel="stylesheet" type="text/css" href="./glg-add-to-project.less" shim-shadowdom>
    <glg-current-user id="atpuser" username="{{username}}"></glg-current-user>
    <glg-nectar
      id="nectar"
      urls="wss://nectar.glgroup.com/ws"
      entities="consults"
      interleave="true"
      scoreThreshold="0.5"
      howMany="10"
      secondarySortField="createDate"
      secondarySortOrder="desc"
      >
    </glg-nectar>
    <div id="spinner" class="progress"><div>Loadingâ€¦</div></div>
    <div id="inputwrapper" class="glg-hidden">
      <div id="projowner">
        <span>
          <core-selector id="selectProjOwner" multi="false" class="options" selected="0">
            <span>mine</span>
            <span>anyone</span>
          <core-selector>
        </span>
        <span style="font-size: 1rem; font-weight:bold; color:lightgrey;">|</span>
        <span>
          <core-selector id="selectProjType" multi="false" class="options" selected="0">
            <span>consults</span>
            <span>surveys</span>
            <span>meetings</span>
          <core-selector>
        </span>
      </div>
      <ui-typeahead
          id="projects"
          sticky
          placeholder="Find a project by name..."
          debounce="50">
        <template id="projectMatches" repeat="{{matches}}">
          <ui-typeahead-item>
            <div class="proj-name">
              {{name}}
              <div class="proj-meta">
                <span>{{createDate | date}} </span>
                <span class="proj-meta-important"> {{firm || client}}</span>
              </div>
            </div>
          </ui-typeahead-item>
        </template>
      </ui-typeahead>
      <icon search></icon>
    </div>
  </template>
  <script src="../bower_components/polymer-filters/filter-date.js"></script>
  <script src="./glg-add-to-project.litcoffee"></script>
</polymer-element>
